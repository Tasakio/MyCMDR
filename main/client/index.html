<html>

<head>
  <title>MyCMDR</title>
  <link rel="icon" type="image/ico" href="/client/web.ico">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://bootswatch.com/sandstone/bootstrap.min.css">
  <link href="/client/stylesheet.css" rel="stylesheet" type="text/css">
  <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
  <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
  <script src="https://use.fontawesome.com/39c63bd017.js"></script>
  <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>

<body>

  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu-bar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
        <a class="navbar-brand" href="javascript:ChangeMenu('HOME');">MyCMDR</a>
      </div>
      <div class="collapse navbar-collapse" id="menu-bar">
        <ul class="nav navbar-nav">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><i class="fa fa-crosshairs" aria-hidden="true"></i> Combat <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="javascript:ChangeMenu('BOUNTYLOG');">Bounty Log</a></li>
                <li><a href="javascript:ChangeMenu('BOUNTY');">Bounty Statistics</a></li>
            </ul>
          </li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><i class="fa fa-globe" aria-hidden="true"></i> Exploration <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="javascript:ChangeMenu('EXPLORATION');">Exploration History</a></li>
            </ul>
          </li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><i class="fa fa-bar-chart" aria-hidden="true"></i> Trading <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="javascript:ChangeMenu('TRADE');">Trade History</a></li>
            </ul>
          </li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="javascript:toggleFullScreen();" id="fullScreenToggle"><i class="fa fa-toggle-off fa-2x" aria-hidden="true"></i></a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container-fluid">
    <!-- BODY START -->

    <!-- PROFILE -->
    <div id="HOME_MENU">
      <div class="col-md-2">
        <h1 id="CmdrName"></h1>
        <p id="Balance"></p>

        <h1 id="Ship"></h1>
        <p id="ShipName"></p>
        <p id="ShipID"></p>
      </div>
      <div class="col-md-5">
        <h1>Pilot Ranks</h1>
        <p id="CombatTitle"></p>
        <div class="progress">
          <div class="progress-bar progress-bar-danger" id="CombatProgress" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;"></div>
        </div>
        <p id="TradeTitle"></p>
        <div class="progress">
          <div class="progress-bar progress-bar-success" id="TradeProgress" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;"></div>
        </div>
        <p id="ExploreTitle"></p>
        <div class="progress">
          <div class="progress-bar progress-bar-info" id="ExploreProgress" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;"></div>
        </div>
      </div>
      <div class="col-md-5">
        <h1>Faction Ranks</h1>
        <p id="FederationTitle">Federation</p>
        <div class="progress">
          <div class="progress-bar progress-bar-warning" id="FederationProgress" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;"></div>
        </div>
        <p id="EmpireTitle">Empire</p>
        <div class="progress">
          <div class="progress-bar progress-bar-warning" id="EmpireProgress" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;"></div>
        </div>
      </div>
    </div>
    <!-- BOUNTY -->
    <div id="BOUNTYLOG_MENU" style="display:none;">
      <div class="col-md-12">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Target</th>
              <th>Reward</th>
            </tr>
          </thead>
          <tbody id="BOUNTYDATA">
          </tbody>
        </table>
      </div>
    </div>
    <div id="BOUNTY_MENU" style="display:none;">
      <div class="col-md-12">
        <h2 id="BOUNTIES"></h2>
      </div>
    </div>
    <!-- EXPLORATION -->
    <div id="EXPLORATION_MENU" style="display:none;">
      <table class="table table-striped">
        <thead>
          <tr>
            <th class="col-md-5">Star System</th>
            <th class="col-md-2">Security</th>
            <th class="col-md-2">Government</th>
            <th class="col-md-2">Economy</th>
            <th class="col-md-1">Distance</th>
          </tr>
        </thead>
        <tbody id="EXPLOREDATA">
        </tbody>
      </table>
    </div>
    <!-- TRADE -->
    <div id="TRADE_MENU" style="display:none;">
      <h2>Commodities Sold</h2>
      <table class="table table-striped">
        <thead>
          <tr>
            <th class="col-md-5">Commodity Name</th>
            <th class="col-md-1">Quantity</th>
            <th class="col-md-2">Sold for</th>
            <th class="col-md-2">Total Sale</th>
            <th class="col-md-2">Profit</th>
          </tr>
        </thead>
        <tbody id="SELLDATA">
        </tbody>
      </table>

      <h2>Commodities Bought</h2>
      <table class="table table-striped">
        <thead>
          <tr>
            <th class="col-md-5">Commodity Name</th>
            <th class="col-md-1">Quantity</th>
            <th class="col-md-3">Buy Price</th>
            <th class="col-md-3">Total Cost</th>
          </tr>
        </thead>
        <tbody id="BOUGHTDATA">
        </tbody>
      </table>
    </div>
    <!-- REMOTE -->
    <div id="REMOTE_MENU" style="display:none;">
    </div>

    <!-- BODY END -->
  </div>

  <div id="loadScreen"><img src="/client/LoadIcon.svg" id="loadImg"></div>
</body>
<script>
  var fullScreen = false;
  var socket = io();

  socket.on('disconnect', function() {
    document.getElementById('loadScreen').style.display = "block";
    document.body.style.overflow = "hidden";
  });

  var MENUS = [];
  MENUS.push(document.getElementById('HOME_MENU'),
    document.getElementById('BOUNTYLOG_MENU'),
    document.getElementById('BOUNTY_MENU'),
    document.getElementById('EXPLORATION_MENU'),
    document.getElementById('TRADE_MENU'));

  function ChangeMenu(menu) {
    for (var i = 0; i < MENUS.length; i++) {
      if (MENUS[i].id === menu + "_MENU") {
        MENUS[i].style.display = 'block';
      } else {
        MENUS[i].style.display = 'none';
      }
    }
  }

  socket.on('cmdrData', function(data) {
    var date = new Date(null);
    date.setSeconds(data.timesince);
    var result = date.toISOString().substr(11, 8);
    //ABOVE IS TIME SINCE SERVER START

    document.getElementById('CmdrName').innerHTML = '<small>CMDR</small> <strong>' + Capitalize(data.name) + '</strong>';
    document.getElementById('Balance').innerHTML = '<strong>Balance</strong> ' + data.credits.toLocaleString() + "CR";

    document.getElementById('Ship').innerHTML = '<small>SHIP</small> <strong>' + Capitalize(data.ship) + '</strong>';
    document.getElementById('ShipName').innerHTML = '<strong>ShipName</strong> ' + Capitalize(data.shipname);
    document.getElementById('ShipID').innerHTML = '<strong>ShipID</strong> ' + Capitalize(data.shipid);

    document.getElementById('CombatTitle').innerHTML = "<strong>Combat</strong> - " + data.combatRank;
    document.getElementById('CombatProgress').style.width = data.combatProgress + "%";
    document.getElementById('TradeTitle').innerHTML = "<strong>Trade</strong> - " + data.tradeRank;
    document.getElementById('TradeProgress').style.width = data.tradeProgress + "%";
    document.getElementById('ExploreTitle').innerHTML = "<strong>Explorer</strong> - " + data.exploreRank;
    document.getElementById('ExploreProgress').style.width = data.exploreProgress + "%";

    document.getElementById('FederationTitle').innerHTML = "<strong>Federation</strong> - " + data.federationRank;
    document.getElementById('FederationProgress').style.width = data.federationProgress + "%";
    document.getElementById('EmpireTitle').innerHTML = "<strong>Empire</strong> - " + data.empireRank;
    document.getElementById('EmpireProgress').style.width = data.empireProgress + "%";

    document.getElementById('loadScreen').style.display = "none";
    document.body.style.overflow = "visible";
  });

  socket.on('bountyData', function(data) {
    var bountyPanel = document.getElementById('BOUNTYDATA');
    bountyPanel.innerHTML = "";
    var bountyTxt = document.getElementById('BOUNTIES');
    var bounty = 0;
    data.reverse();
    for (var i = 0; i < data.length; i++) {
      bounty += parseInt(data[i].reward.toString());
      bountyPanel.innerHTML += prettyBounty(data[i]);
    }
    bountyTxt.innerHTML = "Total: " + bounty.toLocaleString() + "CR";
  });

  socket.on('exploreData', function(data) {
    var explorePanel = document.getElementById('EXPLOREDATA');
    explorePanel.innerHTML = "";
    data.reverse();
    for (var i = 0; i < data.length; i++) {
      explorePanel.innerHTML += prettyExploration(data[i]);
    }
  });

  socket.on('tradeData', function(data) {
    var soldPanel = document.getElementById('SELLDATA');
    var boughtPanel = document.getElementById('BOUGHTDATA');
    soldPanel.innerHTML = "";
    boughtPanel.innerHTML = "";
    data.reverse();
    for (var i = 0; i < data.length; i++) {
      if (data[i].buySell === "MarketSell") {
        soldPanel.innerHTML += prettyTrade(data[i]);
      } else {
        boughtPanel.innerHTML += prettyTrade(data[i]);
      }
    }
  });

  function prettyBounty(data) {
    var panel = '<tr>' +
      '<td>' + Capitalize(data.target) + '</td>' +
      '<td>' + data.reward.toLocaleString() + 'CR</td>' +
      '</tr>';
    return panel;
  }

  function prettyExploration(data) {
    var panel = '<tr>' +
      '<td>' + data.starSystem + '</td>' +
      '<td>' + data.security + '</td>' +
      '<td>' + data.government + '</td>' +
      '<td>' + data.economy + '</td>' +
      '<td>' + data.dist.toFixed(2) + 'Ly</td>' +
      '</tr>';
    return panel;
  }

  function prettyTrade(data, sold) {
    var panel = '';
    if (data.buySell === "MarketBuy") {
      panel = '<tr>' +
        '<td>' + Capitalize(data.type) + '</td>' +
        '<td>' + data.count + '</td>' +
        '<td>' + data.pricePaid.toLocaleString() + 'CR</td>' +
        '<td>-' + (data.pricePaid * data.count).toLocaleString() + 'CR</td>' +
        '</tr>';
    } else if (data.buySell === "MarketSell") {
      var color;
      if (Profit(data.priceSold, data.pricePaid, data.count) > 0) {
        color = ' class="success"';
      }
      panel = '<tr' + color + '>' +
        '<td>' + Capitalize(data.type) + '</td>' +
        '<td>' + data.count + '</td>' +
        '<td>' + data.priceSold.toLocaleString() + 'CR</td>' +
        '<td>' + data.total.toLocaleString() + 'CR</td>' +
        '<td>' + Profit(data.priceSold, data.pricePaid, data.count).toLocaleString() + 'CR</td>' +
        '</tr>';
    }
    return panel;
  }

  function Profit(sellPrice, buyPrice, amount) {
    sellPrice = parseInt(sellPrice);
    buyPrice = parseInt(buyPrice);
    amount = parseInt(amount);
    var x = buyPrice;
    return ((sellPrice - buyPrice) * amount);
  }

  function Capitalize(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
  }

  function ChangeProgress(obj, val, txt) {
    obj.innerHTML = txt + " - " + val + "%";
    obj.style.width = val + "%";
  }

  function toggleFullScreen() {
    fullScreen = !fullScreen;
    var doc = document.getElementById('fullScreenToggle');
    if (fullScreen) {
      doc.innerHTML = '<i class="fa fa-toggle-on fa-2x" aria-hidden="true"></i>';
    } else {
      doc.innerHTML = '<i class="fa fa-toggle-off fa-2x" aria-hidden="true"></i>';
    }
    if ((document.fullScreenElement && document.fullScreenElement !== null) ||
      (!document.mozFullScreen && !document.webkitIsFullScreen)) {
      if (document.documentElement.requestFullScreen) {
        document.documentElement.requestFullScreen();
      } else if (document.documentElement.mozRequestFullScreen) {
        document.documentElement.mozRequestFullScreen();
      } else if (document.documentElement.webkitRequestFullScreen) {
        document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
      }
    } else {
      if (document.cancelFullScreen) {
        document.cancelFullScreen();
      } else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen();
      } else if (document.webkitCancelFullScreen) {
        document.webkitCancelFullScreen();
      }
    }
  }
</script>

</html>
